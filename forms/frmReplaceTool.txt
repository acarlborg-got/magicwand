

Option Explicit

' Väljer mapp för PDF-export
Private Sub btnBrowsePDFPath_Click()
    With Application.FileDialog(msoFileDialogFolderPicker)
        .Title = "Välj alternativ PDF-mapp"
        If .Show = -1 Then
            txtAltPDFPath.Text = .SelectedItems(1)
        End If
    End With
End Sub

' Startar bearbetningen efter validering
Private Sub btnStart_Click()
    If Not ValidateProcessingSettings() Then Exit Sub
    StartProcessing
End Sub

' Samlar in fält från formuläret och kör ProcessIndexedDocuments
Private Sub StartProcessing()
    Dim findTexts(1 To 5) As String
    Dim replaceTexts(1 To 5) As String
    Dim caseFlags(1 To 5) As Boolean
    Dim wordFlags(1 To 5) As Boolean
    Dim i As Long

    For i = 1 To 5
        findTexts(i) = Me.Controls("txtFind" & i).Text
        replaceTexts(i) = Me.Controls("txtReplace" & i).Text
        caseFlags(i) = Me.Controls("chkCase" & i).Value
        wordFlags(i) = Me.Controls("chkWhole" & i).Value
    Next i

    ProcessIndexedDocuments findTexts, replaceTexts, caseFlags, wordFlags, _
        Me.chkExportPDF.Value, Me.cmbPDFType.Text, Me.txtAltPDFPath.Text, _
        Me.txtPrefix.Text, Me.txtSuffix.Text, Me.chkKeepOriginal.Value, _
        Me.cmbLanguage.Text
End Sub

' Avbryter pågående bearbetning
Private Sub btnCancel_Click()
    cancelRequested = True
    lblStatus2.Caption = "Status: Aborting..."
End Sub

' Initierar stavningskontroll på indexerade filer
Private Sub btnSpellcheck_Click()
    ' Rensa alla tidigare sök-/ersättfält och listan
    Dim i As Long
    For i = 1 To 5
        Me.Controls("txtFind" & i).Text = ""
        Me.Controls("txtReplace" & i).Text = ""
        Me.Controls("chkCase" & i).Value = False
        Me.Controls("chkWhole" & i).Value = False
    Next i
    Me.lstSpellingResult.Clear

' === Kör stavningsanalysen på indexerade filer ===
Dim filePaths() As String
filePaths = GetSelectedFilePaths()

Call PreScanSpelling( _
    filePaths:=filePaths, _
    language:=Me.cmbLanguage.Text, _
    preserveFolderName:=Me.txtPreserveSubFolder.Text)

End Sub


' (Ej använd) Händelse för språkbyte
Private Sub cmbLanguage_Change()

End Sub

' (Ej använd) Klick på "Created By"-text
Private Sub lblCreatedBy_Click()

End Sub

' (Ej använd) Klick på etikett
Private Sub Label16_Click()

End Sub

' (Ej använd) Visar applikationsversion
Private Sub lblAppVersion_Click()

End Sub

' Öppnar Teams-chatt med utvecklaren
Private Sub lblAuthor_Click()
    ' Öppna Teams chatt
    ThisDocument.FollowHyperlink "https://teams.microsoft.com/l/chat/0/0?users=alexander.carlborg@afry.com"
End Sub

' (Ej använd) Klick på progressbaren
Private Sub lblProgressBar_Click()

End Sub

' (Ej använd) Klick på statusrutan
Private Sub lblStats_Click()

End Sub

' Initierar formuläret och laddar sparad fil-lista
Private Sub UserForm_Initialize()
    Me.Caption = GetTitle_frmReplaceTool()
    LoadLanguage DEFAULT_LANGUAGE
    lblAppVersion.Caption = GetAppVersion()
    btnStart.Caption = T("START")
    btnCancel.Caption = T("CANCEL")
    lblStatus2.Caption = T("STATUS_READY")

cmbPDFType.Clear
cmbPDFType.AddItem "Normal"
cmbPDFType.AddItem "PDF/A-1b"
cmbPDFType.ListIndex = 0

cmbLanguage.Clear
cmbLanguage.AddItem "Svenska"
cmbLanguage.AddItem "Engelska"
cmbLanguage.ListIndex = 0

chkExportPDF.Value = False
chkKeepOriginal.Value = False

lblProgress.Caption = ""
lblStats.Caption = ""
lblProgressBar.Width = 0

' === Läs in sparade filer från frmIndexBrowser ===
Dim files() As tFileSelection
Dim fullPaths() As String
Dim i As Long

On Error GoTo NoFiles
files = GetSelectedFiles()
fullPaths = GetSelectedFilePaths()

If (Not Not files) = False Or UBound(files) < 0 Then GoTo NoFiles

lstFiles.Clear
For i = 0 To UBound(files)
    lstFiles.AddItem fullPaths(i)
Next i

lblStats.Caption = "Loaded " & UBound(files) + 1 & " file(s) from saved index"
Exit Sub

NoFiles:
    lstFiles.Clear
    lblStats.Caption = "No files loaded from index."


End Sub







